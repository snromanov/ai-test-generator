"""
Промпты для UI тестирования.

Содержит специализированные промпты и техники для:
- Тестирования календарей
- Тестирования форм
- Тестирования загрузки файлов
- Тестирования drag-and-drop
"""

UI_SYSTEM_PROMPT = """Ты ведущий QA инженер, специализирующийся на UI/UX тестировании.

## Принципы UI тестирования:

1. **Пользовательский опыт**: Тесты должны отражать реальные сценарии использования
2. **Кросс-браузерность**: Учитывай различия в браузерах (Chrome, Firefox, Safari, Edge)
3. **Адаптивность**: Проверяй поведение на разных размерах экрана
4. **Доступность (a11y)**: Тестируй с клавиатурой, screen reader
5. **Состояния элементов**: hover, focus, active, disabled, loading, error
6. **Визуальная регрессия**: Отслеживай изменения в UI

## Жесткие правила для UI-тестов:
1. Если требование помечено [Front]/[UI], генерируй ТОЛЬКО UI-тесты. 
   Запрещено выдумывать API, эндпоинты, JSON body, статусы ответа.
2. Никаких заглушек "N/A" в шагах и предусловиях.
3. Каждый пункт требования должен иметь хотя бы один тест-кейс, иначе — coverage_gaps.
4. Если данные/правила не заданы, фиксируй Assumptions/Questions.

## Формат UI тест-кейса:

- ID: TC-UI-[Component]-[Number]
- Название: Действие пользователя + Ожидаемое поведение UI
- Приоритет: Critical (блокирующие UX), High (основной flow), Medium (альтернативы), Low (edge cases)
- Предусловия: Состояние страницы, данные, размер экрана
- Шаги: Действия пользователя с конкретными элементами
- Ожидаемый результат: Визуальное состояние, поведение, сообщения
- Тип: Positive, Negative, Boundary, Accessibility, Visual
- Техника: ui_form, ui_calendar, ui_file_upload и др.
"""

UI_CALENDAR_TECHNIQUES = """
## Техники тестирования календарей (ui_calendar)

### 1. Базовые взаимодействия
- Открытие/закрытие календаря по клику
- Навигация по месяцам (вперед/назад)
- Навигация по годам
- Выбор даты кликом
- Закрытие при клике вне календаря

### 2. Граничные значения дат
- Минимальная допустимая дата
- Максимальная допустимая дата
- Переход через границу месяца (31 января → 1 февраля)
- Переход через границу года (31 декабря → 1 января)
- Високосный год (29 февраля)

### 3. Диапазоны дат (если применимо)
- Выбор начальной даты
- Выбор конечной даты
- Начальная дата > конечной (должно блокироваться)
- Одна и та же дата как начало и конец
- Максимальный диапазон (если есть ограничение)

### 4. Отключенные даты
- Прошедшие даты (если отключены)
- Выходные (если отключены)
- Праздничные дни
- Специфичные отключенные даты

### 5. Локализация
- Формат отображения даты (DD.MM.YYYY, MM/DD/YYYY)
- Названия месяцев на разных языках
- Первый день недели (понедельник/воскресенье)

### 6. Клавиатурная навигация
- Tab для перехода к календарю
- Стрелки для навигации по дням
- Enter для выбора даты
- Escape для закрытия

### 7. Мобильные устройства
- Touch события
- Нативный date picker на iOS/Android
- Размер touch target (минимум 44x44px)
"""

UI_FORM_TECHNIQUES = """
## Техники тестирования форм (ui_form)

### 1. Валидация полей
- Обязательные поля (пустое значение)
- Формат данных (email, телефон, URL)
- Минимальная/максимальная длина
- Допустимые символы
- Real-time vs submit валидация

### 2. Состояния полей
- Default (пустое)
- Focus (курсор в поле)
- Filled (заполненное)
- Error (с ошибкой валидации)
- Disabled (отключенное)
- Read-only (только чтение)

### 3. Типы полей
- Text input
- Password (показать/скрыть)
- Textarea (автовысота, счетчик символов)
- Select/Dropdown
- Checkbox (single, group)
- Radio buttons
- Toggle/Switch

### 4. Автозаполнение
- Browser autocomplete
- Подсказки при вводе
- Выбор из предложенных

### 5. Отправка формы
- Submit при нажатии Enter
- Submit по кнопке
- Disable кнопки при отправке
- Loading state
- Success/Error feedback

### 6. Сохранение данных
- Autosave (draft)
- Предупреждение при уходе со страницы
- Восстановление после ошибки

### 7. Доступность (a11y)
- Label связан с input
- Aria-required для обязательных
- Aria-invalid для ошибок
- Сообщения об ошибках для screen reader
"""

UI_FILE_UPLOAD_TECHNIQUES = """
## Техники тестирования загрузки файлов (ui_file_upload)

### 1. Способы загрузки
- Клик по кнопке/зоне + выбор файла
- Drag-and-drop файла
- Drag-and-drop нескольких файлов
- Вставка из буфера обмена (Ctrl+V)

### 2. Валидация файлов
- Допустимые форматы (расширения)
- Максимальный размер файла
- Минимальный размер (если есть)
- Максимальное количество файлов
- MIME-type валидация

### 3. Состояния загрузки
- Idle (ожидание выбора)
- Dragging (файл над зоной)
- Uploading (процесс загрузки)
- Progress (индикатор прогресса)
- Success (файл загружен)
- Error (ошибка загрузки)

### 4. Превью и информация
- Thumbnail для изображений
- Имя файла
- Размер файла
- Иконка типа файла

### 5. Управление файлами
- Удаление загруженного файла
- Замена файла
- Изменение порядка (если важен)
- Редактирование метаданных

### 6. Граничные случаи
- Файл размером 0 байт
- Файл максимального размера
- Файл чуть больше максимального
- Файл с длинным именем (255+ символов)
- Файл со спецсимволами в имени
- Файл без расширения
- Файл с двойным расширением (.jpg.exe)

### 7. Сетевые условия
- Медленное соединение
- Прерывание загрузки
- Повторная попытка (retry)
- Отмена загрузки

### 8. Изображения (специфика)
- Поворот изображения
- Обрезка (crop)
- Изменение размера
- Валидация разрешения (min/max dimensions)
- Валидация соотношения сторон
"""

FEW_SHOT_UI_CALENDAR = """
## Пример: Тест-кейсы для календаря выбора даты

### Требование:
Календарь для выбора даты бронирования. Минимальная дата - сегодня.
Максимальная дата - 365 дней от сегодня.

### Тест-кейсы:

```json
{
  "test_cases": [
    {
      "id": "TC-UI-CAL-001",
      "title": "Открытие календаря при клике на поле даты",
      "priority": "Critical",
      "preconditions": [
        "Страница бронирования загружена",
        "Поле даты видимо и доступно"
      ],
      "steps": [
        {"step": 1, "action": "Кликнуть на поле ввода даты"},
        {"step": 2, "action": "Наблюдать появление календаря"}
      ],
      "expected_result": "1. Календарь появляется под полем\\n2. Текущий месяц отображается\\n3. Сегодняшняя дата выделена\\n4. Прошедшие даты недоступны (серые)",
      "test_type": "Positive",
      "technique": "ui_calendar",
      "layer": "ui",
      "component": "frontend",
      "ui_element": "date-picker"
    },
    {
      "id": "TC-UI-CAL-002",
      "title": "Выбор сегодняшней даты (минимальная граница)",
      "priority": "High",
      "preconditions": [
        "Календарь открыт",
        "Отображается текущий месяц"
      ],
      "steps": [
        {"step": 1, "action": "Кликнуть на сегодняшнюю дату"},
        {"step": 2, "action": "Проверить поле ввода"}
      ],
      "expected_result": "1. Календарь закрывается\\n2. В поле отображается сегодняшняя дата в формате DD.MM.YYYY\\n3. Дата подсвечена как выбранная",
      "test_type": "Boundary",
      "technique": "ui_calendar",
      "layer": "ui",
      "component": "frontend",
      "ui_element": "date-picker"
    },
    {
      "id": "TC-UI-CAL-003",
      "title": "Попытка выбора вчерашней даты (за границей)",
      "priority": "High",
      "preconditions": [
        "Календарь открыт"
      ],
      "steps": [
        {"step": 1, "action": "Найти вчерашнюю дату в календаре"},
        {"step": 2, "action": "Попытаться кликнуть на неё"}
      ],
      "expected_result": "1. Дата отображается серым цветом\\n2. Курсор: not-allowed\\n3. Клик не выбирает дату\\n4. Календарь остаётся открытым",
      "test_type": "Negative",
      "technique": "ui_calendar",
      "layer": "ui",
      "component": "frontend",
      "ui_element": "date-picker"
    },
    {
      "id": "TC-UI-CAL-004",
      "title": "Навигация на следующий месяц",
      "priority": "Medium",
      "preconditions": [
        "Календарь открыт на текущем месяце"
      ],
      "steps": [
        {"step": 1, "action": "Кликнуть на кнопку '>' (следующий месяц)"},
        {"step": 2, "action": "Проверить отображаемый месяц"}
      ],
      "expected_result": "1. Отображается следующий месяц\\n2. Заголовок обновился (например, 'Февраль 2024')\\n3. Все даты месяца доступны для выбора",
      "test_type": "Positive",
      "technique": "ui_calendar",
      "layer": "ui",
      "component": "frontend",
      "ui_element": "date-picker-navigation"
    }
  ]
}
```
"""

FEW_SHOT_FILE_UPLOAD = """
## Пример: Тест-кейсы для загрузки файлов

### Требование:
Загрузка фотографий профиля. Форматы: JPG, PNG.
Максимальный размер: 5 MB. Максимум 1 файл.

### Тест-кейсы:

```json
{
  "test_cases": [
    {
      "id": "TC-UI-UPLOAD-001",
      "title": "Успешная загрузка JPG изображения",
      "priority": "Critical",
      "preconditions": [
        "Страница профиля открыта",
        "Подготовлен файл test.jpg (размер < 5 MB)"
      ],
      "steps": [
        {"step": 1, "action": "Кликнуть на зону загрузки 'Выберите файл'"},
        {"step": 2, "action": "В диалоге выбрать файл test.jpg"},
        {"step": 3, "action": "Нажать 'Открыть'"},
        {"step": 4, "action": "Дождаться завершения загрузки"}
      ],
      "expected_result": "1. Появляется индикатор загрузки\\n2. После загрузки отображается превью изображения\\n3. Показывается имя файла и размер\\n4. Появляется кнопка удаления",
      "test_type": "Positive",
      "technique": "ui_file_upload",
      "layer": "ui",
      "component": "fullstack",
      "ui_element": "file-upload-zone"
    },
    {
      "id": "TC-UI-UPLOAD-002",
      "title": "Загрузка файла через drag-and-drop",
      "priority": "High",
      "preconditions": [
        "Страница профиля открыта",
        "Файл test.png открыт в файловом менеджере"
      ],
      "steps": [
        {"step": 1, "action": "Перетащить файл test.png на зону загрузки"},
        {"step": 2, "action": "Отпустить файл"},
        {"step": 3, "action": "Дождаться загрузки"}
      ],
      "expected_result": "1. При наведении зона подсвечивается (border: dashed blue)\\n2. После drop файл загружается\\n3. Отображается превью",
      "test_type": "Positive",
      "technique": "ui_file_upload",
      "layer": "ui",
      "component": "fullstack",
      "ui_element": "file-upload-zone"
    },
    {
      "id": "TC-UI-UPLOAD-003",
      "title": "Отклонение файла недопустимого формата (GIF)",
      "priority": "High",
      "preconditions": [
        "Подготовлен файл animation.gif"
      ],
      "steps": [
        {"step": 1, "action": "Попытаться загрузить animation.gif"},
        {"step": 2, "action": "Проверить сообщение об ошибке"}
      ],
      "expected_result": "1. Файл не загружается\\n2. Появляется сообщение: 'Допустимые форматы: JPG, PNG'\\n3. Зона загрузки остаётся в исходном состоянии",
      "test_type": "Negative",
      "technique": "ui_file_upload",
      "layer": "ui",
      "component": "frontend",
      "ui_element": "file-upload-zone"
    },
    {
      "id": "TC-UI-UPLOAD-004",
      "title": "Отклонение файла превышающего лимит размера",
      "priority": "High",
      "preconditions": [
        "Подготовлен файл large-image.jpg (размер 6 MB)"
      ],
      "steps": [
        {"step": 1, "action": "Выбрать файл large-image.jpg"},
        {"step": 2, "action": "Проверить валидацию размера"}
      ],
      "expected_result": "1. Файл не загружается\\n2. Появляется сообщение: 'Максимальный размер файла: 5 MB'\\n3. Файл не отправляется на сервер",
      "test_type": "Boundary",
      "technique": "ui_file_upload",
      "layer": "ui",
      "component": "frontend",
      "ui_element": "file-upload-zone"
    },
    {
      "id": "TC-UI-UPLOAD-005",
      "title": "Удаление загруженного файла",
      "priority": "Medium",
      "preconditions": [
        "Файл успешно загружен",
        "Отображается превью с кнопкой удаления"
      ],
      "steps": [
        {"step": 1, "action": "Кликнуть на кнопку удаления (X или корзина)"},
        {"step": 2, "action": "Подтвердить удаление (если есть диалог)"}
      ],
      "expected_result": "1. Превью исчезает\\n2. Зона загрузки возвращается в исходное состояние\\n3. Файл удалён с сервера (проверить в Network)",
      "test_type": "Positive",
      "technique": "ui_file_upload",
      "layer": "ui",
      "component": "fullstack",
      "ui_element": "file-upload-delete-button"
    }
  ]
}
```
"""

UI_DRAG_DROP_TECHNIQUES = """
## Техники тестирования Drag-and-Drop (ui_drag_drop)

### 1. Базовые операции
- Захват элемента (mousedown/touchstart)
- Перемещение (mousemove/touchmove)
- Отпускание (mouseup/touchend)
- Визуальная обратная связь при захвате

### 2. Зоны перетаскивания
- Валидная зона (подсветка при наведении)
- Невалидная зона (запрет drop)
- Область вне всех зон (отмена)

### 3. Сортировка списков
- Перемещение вверх
- Перемещение вниз
- Перемещение в начало/конец
- Placeholder (место для вставки)

### 4. Перемещение между контейнерами
- Из списка A в список B
- Ограничения на перемещение
- Копирование vs перемещение

### 5. Touch-устройства
- Long press для начала drag
- Прокрутка во время drag
- Мультитач (отмена)

### 6. Клавиатурная альтернатива
- Space/Enter для захвата
- Стрелки для перемещения
- Space/Enter для drop
- Escape для отмены

### 7. Граничные случаи
- Быстрый drag-drop (< 100ms)
- Drag за пределы viewport
- Drag при прокрутке страницы
- Множественное выделение и drag
"""

# Экспортируемые функции
def get_ui_system_prompt() -> str:
    """Возвращает системный промпт для UI тестирования."""
    return UI_SYSTEM_PROMPT


def get_ui_technique_prompt(technique: str) -> str:
    """Возвращает промпт для конкретной UI техники."""
    techniques = {
        "ui_calendar": UI_CALENDAR_TECHNIQUES,
        "ui_form": UI_FORM_TECHNIQUES,
        "ui_file_upload": UI_FILE_UPLOAD_TECHNIQUES,
        "ui_drag_drop": UI_DRAG_DROP_TECHNIQUES,
    }
    return techniques.get(technique, "")


def get_ui_few_shot_example(example_type: str) -> str:
    """Возвращает few-shot пример для указанного типа."""
    examples = {
        "calendar": FEW_SHOT_UI_CALENDAR,
        "file_upload": FEW_SHOT_FILE_UPLOAD,
    }
    return examples.get(example_type, "")
